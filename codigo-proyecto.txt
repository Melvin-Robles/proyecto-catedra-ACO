#include <Servo.h>
#include <Wire.h>
#include <LiquidCrystal_I2C.h>

// Componentes
Servo servoMotor;
LiquidCrystal_I2C lcd(0x27, 16, 2); // Cambia a 0x3F si no se muestra nada

// Pines
const int soilPin = A0;
const int tempPin = A1;
const int ldrPin = A2;
const int ledPin = 8;
const int servoPin = 10;
const int transistorPin = 9;

// Umbrales
const int soilThreshold = 600; // Ajusta según humedad deseada
const int lightThreshold = 600; // Límite de luz para permitir riego

void setup() {
  Serial.begin(9600);
  pinMode(ledPin, OUTPUT);
  pinMode(transistorPin, OUTPUT);
  servoMotor.attach(servoPin);

  lcd.init();
  lcd.backlight();
  lcd.print("Sistema Riego");
  delay(1500);
  lcd.clear();
}

void loop() {
  int soilValue = analogRead(soilPin);
  int tempValue = analogRead(tempPin);
  int lightValue = analogRead(ldrPin);
  float temperatureC = (tempValue * 5.0 / 1023.0 - 0.5) * 100;

  lcd.setCursor(0, 0);
  lcd.print("Hum:");
  lcd.print(soilValue);
  lcd.print(" T:");
  lcd.print(temperatureC, 1);

  lcd.setCursor(0, 1);
  lcd.print("Luz:");
  lcd.print(lightValue);

  if (soilValue < soilThreshold && lightValue > lightThreshold) {
    digitalWrite(ledPin, HIGH);
    digitalWrite(transistorPin, HIGH);
    servoMotor.write(90); // Abre válvula
    lcd.setCursor(10, 1);
    lcd.print("RIEGO");
  } else {
    digitalWrite(ledPin, LOW);
    digitalWrite(transistorPin, LOW);
    servoMotor.write(0); // Cierra válvula
    lcd.setCursor(10, 1);
    lcd.print("     ");
  }

  delay(2000);
}
